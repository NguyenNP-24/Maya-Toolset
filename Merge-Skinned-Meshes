import maya.cmds as cmds

def combine_meshes():
    selected = cmds.ls(selection=True, long=True)

    if len(selected) < 2:
        cmds.error("Vui lòng ch\u1ecdn ít nh\u1ea5t 2 mesh \u0111\u1ec3 combine!")

    for obj in selected:
        if cmds.objectType(obj) != "transform" and cmds.objectType(obj) != "mesh":
            cmds.error(f"{obj} không ph\u1ea3i là mesh ho\u1eb7c transform node h\u1ee3p l\u1ec7! Vui lòng ch\u1ecdn các mesh h\u1ee3p l\u1ec7.")
        
        if cmds.objectType(obj) == "transform":
            children = cmds.listRelatives(obj, children=True) or []
            if not any(cmds.objectType(child) == "mesh" for child in children):
                cmds.error(f"{obj} không ch\u1ee9a b\u1ea5t k\u1ef3 mesh nào! Vui lòng ch\u1ecdn các mesh h\u1ee3p l\u1ec7.")
    
    # Deselect
    cmds.select(clear=True)

    # Combine 
    combined = cmds.polyUnite(selected, name="combinedMesh")[0]

    cmds.delete(combined, constructionHistory=True)

    groups = cmds.listRelatives(combined, allDescendents=True, type="transform")
    for group in groups:
        if cmds.listRelatives(group, children=True) == []:  # Ki\u1ec3m tra group có con không
            cmds.delete(group)  # Xóa group r\u1ed7ng

    cmds.select(combined)

combine_meshes()
