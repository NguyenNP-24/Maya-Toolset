import maya.cmds as cmds

def smart_extract_separate():
    sel = cmds.ls(selection=True, flatten=True)

    if not sel:
        cmds.warning('Không có gì \u0111\u01b0\u1ee3c ch\u1ecdn.')
        return

    if '.f[' in sel[0]:
        faces = sel
    elif '.vtx[' in sel[0] or '.e[' in sel[0]:
        faces = cmds.polyListComponentConversion(sel, toFace=True)
        faces = cmds.ls(faces, flatten=True)
    else:
        cmds.warning('Vui lòng ch\u1ecdn face, vertex ho\u1eb7c edge.')
        return

    if not faces:
        cmds.warning('Không tìm th\u1ea5y face sau khi convert.')
        return

    base_obj = faces[0].split('.')[0]

    dup_obj = cmds.duplicate(base_obj, name=base_obj + '_extracted')[0]

    all_faces_dup = cmds.ls(dup_obj + '.f[*]', flatten=True)
    faces_to_delete = list(set(all_faces_dup) - set([f.replace(base_obj, dup_obj) for f in faces]))
    if faces_to_delete:
        cmds.delete(faces_to_delete)

    cmds.delete(faces)

    # Cleanup 
    cmds.select(dup_obj)
    cmds.makeIdentity(apply=True, t=1, r=1, s=1, n=0)
    cmds.delete(ch=True)
    cmds.xform(cp=True)

    print('\u2705 Tách mesh thành công!')

smart_extract_separate()
